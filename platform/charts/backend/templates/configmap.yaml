apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "backend.fullname" . }}-config
  labels:
    {{- include "backend.labels" . | nindent 4 }}
data:
  # LLM Configuration
  LLM_PROVIDER: {{ .Values.llm.provider | quote }}
  LLM_MODEL: {{ .Values.llm.model | quote }}
  LLM_TEMPERATURE: {{ .Values.llm.temperature | quote }}
  OPENAI_BASE_URL: {{ .Values.llm.openai.baseUrl | quote }}

  # Database Configuration
  POSTGRESQL_HOST: {{ .Values.postgresql.host | quote }}
  POSTGRESQL_PORT: {{ .Values.postgresql.port | quote }}
  POSTGRESQL_DATABASE: {{ .Values.postgresql.database | quote }}
  POSTGRESQL_USERNAME: {{ .Values.postgresql.username | quote }}

  USER_POSTGRESQL_HOST: {{ .Values.userPostgresql.host | quote }}
  USER_POSTGRESQL_PORT: {{ .Values.userPostgresql.port | quote }}
  USER_POSTGRESQL_DATABASE: {{ .Values.userPostgresql.database | quote }}
  USER_POSTGRESQL_USERNAME: {{ .Values.userPostgresql.username | quote }}

  # Redis Configuration
  REDIS_HOST: {{ .Values.redis.host | quote }}
  REDIS_PORT: {{ .Values.redis.port | quote }}
  REDIS_DATABASE: {{ .Values.redis.database | quote }}

  # Storage Configuration - Internal
  INTERNAL_STORAGE_ENDPOINT: {{ .Values.storage.internal.endpoint | quote }}
  INTERNAL_BUCKET_WEIGHTS: {{ .Values.storage.internal.buckets.weights | quote }}
  INTERNAL_BUCKET_CHECKPOINTS: {{ .Values.storage.internal.buckets.checkpoints | quote }}
  INTERNAL_BUCKET_SCHEMAS: {{ .Values.storage.internal.buckets.schemas | quote }}
  INTERNAL_BUCKET_RESULTS: {{ .Values.storage.internal.buckets.results | quote }}

  # Storage Configuration - External
  EXTERNAL_STORAGE_ENDPOINT: {{ .Values.storage.external.endpoint | quote }}
  EXTERNAL_BUCKET_DATASETS: {{ .Values.storage.external.buckets.datasets | quote }}

  # Security Configuration
  JWT_ALGORITHM: {{ .Values.security.jwtAlgorithm | quote }}
  ACCESS_TOKEN_EXPIRE_MINUTES: {{ .Values.security.accessTokenExpireMinutes | quote }}
  REFRESH_TOKEN_EXPIRE_DAYS: {{ .Values.security.refreshTokenExpireDays | quote }}

  # Observability Configuration
  OBSERVABILITY_BACKENDS: {{ .Values.observability.backends | quote }}
  {{- if .Values.observability.clearml.enabled }}
  CLEARML_API_HOST: {{ .Values.observability.clearml.apiHost | quote }}
  CLEARML_WEB_HOST: {{ .Values.observability.clearml.webHost | quote }}
  CLEARML_FILES_HOST: {{ .Values.observability.clearml.filesHost | quote }}
  {{- end }}
  {{- if .Values.observability.mlflow.enabled }}
  MLFLOW_TRACKING_URI: {{ .Values.observability.mlflow.trackingUri | quote }}
  {{- end }}

  # Application Configuration
  CORS_ORIGINS: {{ .Values.config.corsOrigins | quote }}
  LOG_LEVEL: {{ .Values.config.logLevel | quote }}
  TRAINING_MODE: {{ .Values.config.trainingMode | quote }}
  API_BASE_URL: {{ .Values.config.apiBaseUrl | quote }}

  # Temporal Configuration
  {{- if .Values.temporal.enabled }}
  TEMPORAL_HOST: {{ .Values.temporal.host | quote }}
  TEMPORAL_NAMESPACE: {{ .Values.temporal.namespace | quote }}
  TEMPORAL_TASK_QUEUE: {{ .Values.temporal.taskQueue | quote }}
  {{- end }}

  # Labeler Service
  {{- if .Values.labeler.enabled }}
  LABELER_API_URL: {{ .Values.labeler.apiUrl | quote }}
  {{- end }}
