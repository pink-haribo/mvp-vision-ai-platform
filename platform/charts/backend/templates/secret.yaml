{{- if not .Values.security.existingSecret }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "backend.fullname" . }}-secret
  labels:
    {{- include "backend.labels" . | nindent 4 }}
type: Opaque
stringData:
  # Database passwords
  {{- if .Values.postgresql.password }}
  DATABASE_PASSWORD: {{ .Values.postgresql.password | quote }}
  {{- end }}
  {{- if .Values.userPostgresql.password }}
  USER_DATABASE_PASSWORD: {{ .Values.userPostgresql.password | quote }}
  {{- end }}

  # LLM API Keys
  {{- if eq .Values.llm.provider "openai" }}
  {{- if .Values.llm.openai.apiKey }}
  OPENAI_API_KEY: {{ .Values.llm.openai.apiKey | quote }}
  {{- end }}
  {{- end }}
  {{- if eq .Values.llm.provider "gemini" }}
  {{- if .Values.llm.gemini.apiKey }}
  GOOGLE_API_KEY: {{ .Values.llm.gemini.apiKey | quote }}
  {{- end }}
  {{- end }}

  # Storage credentials
  {{- if .Values.storage.internal.accessKey }}
  INTERNAL_STORAGE_ACCESS_KEY: {{ .Values.storage.internal.accessKey | quote }}
  {{- end }}
  {{- if .Values.storage.internal.secretKey }}
  INTERNAL_STORAGE_SECRET_KEY: {{ .Values.storage.internal.secretKey | quote }}
  {{- end }}
  {{- if .Values.storage.external.accessKey }}
  EXTERNAL_STORAGE_ACCESS_KEY: {{ .Values.storage.external.accessKey | quote }}
  {{- end }}
  {{- if .Values.storage.external.secretKey }}
  EXTERNAL_STORAGE_SECRET_KEY: {{ .Values.storage.external.secretKey | quote }}
  {{- end }}

  # Security secrets
  {{- if .Values.security.jwtSecret }}
  JWT_SECRET: {{ .Values.security.jwtSecret | quote }}
  {{- end }}
  {{- if .Values.security.serviceJwtSecret }}
  SERVICE_JWT_SECRET: {{ .Values.security.serviceJwtSecret | quote }}
  {{- end }}

  # ClearML credentials
  {{- if and .Values.observability.clearml.enabled .Values.observability.clearml.accessKey }}
  CLEARML_API_ACCESS_KEY: {{ .Values.observability.clearml.accessKey | quote }}
  CLEARML_API_SECRET_KEY: {{ .Values.observability.clearml.secretKey | quote }}
  {{- end }}

  # Labeler service key
  {{- if and .Values.labeler.enabled .Values.labeler.serviceKey }}
  LABELER_SERVICE_KEY: {{ .Values.labeler.serviceKey | quote }}
  {{- end }}
{{- end }}
