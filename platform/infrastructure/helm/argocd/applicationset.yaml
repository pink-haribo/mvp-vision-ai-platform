# Vision AI Platform - ArgoCD ApplicationSet
# Single chart from JFrog Helm repo per environment
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: vision-ai-platform
  namespace: argocd
spec:
  generators:
    - list:
        elements:
          - env: dev
            namespace: vision-ai-dev
            cluster: https://kubernetes.default.svc
            chartVersion: "1.0.0"
          - env: staging
            namespace: vision-ai-staging
            cluster: https://kubernetes.default.svc
            chartVersion: "1.0.0"
          - env: prod
            namespace: vision-ai-prod
            cluster: https://kubernetes.default.svc
            chartVersion: "1.0.0"
  template:
    metadata:
      name: "vision-ai-platform-{{env}}"
      labels:
        app.kubernetes.io/part-of: vision-ai-platform
        environment: "{{env}}"
    spec:
      project: vision-ai
      source:
        repoURL: https://your-company.jfrog.io/artifactory/helm-local
        chart: vision-ai-platform
        targetRevision: "{{chartVersion}}"
        helm:
          # Edit values via ArgoCD UI or kubectl edit
          values: |
            # {{env}} environment
      destination:
        server: "{{cluster}}"
        namespace: "{{namespace}}"
      syncPolicy:
        automated:
          prune: true
          selfHeal: true
        syncOptions:
          - CreateNamespace=true
---
# JFrog credentials - apply first:
#   kubectl apply -f argocd-jfrog-secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: jfrog-helm-repo
  namespace: argocd
  labels:
    argocd.argoproj.io/secret-type: repository
type: Opaque
stringData:
  type: helm
  name: jfrog-helm
  url: https://your-company.jfrog.io/artifactory/helm-local
  username: ""
  password: "YOUR_JFROG_TOKEN_HERE"
