# kube-prometheus-stack Helm Values for Platform
# Chart: prometheus-community/kube-prometheus-stack
# Tier 1 Development Environment
# Includes: Prometheus, Grafana, AlertManager, Node Exporter, Kube State Metrics

# Prometheus
prometheus:
  prometheusSpec:
    retention: 30d
    storageSpec:
      volumeClaimTemplate:
        spec:
          storageClassName: standard
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 10Gi

    resources:
      requests:
        memory: 512Mi
        cpu: 500m
      limits:
        memory: 2Gi
        cpu: 2000m

    # Scrape configs
    additionalScrapeConfigs:
      # Backend API
      - job_name: 'backend-api'
        static_configs:
          - targets: ['backend.platform.svc.cluster.local:8000']

      # MLflow
      - job_name: 'mlflow'
        static_configs:
          - targets: ['mlflow.mlflow.svc.cluster.local:5000']

  service:
    type: ClusterIP
    port: 9090

# Grafana
grafana:
  enabled: true

  adminPassword: prom-operator  # Development only

  persistence:
    enabled: true
    storageClassName: standard
    size: 5Gi

  resources:
    requests:
      memory: 256Mi
      cpu: 250m
    limits:
      memory: 512Mi
      cpu: 500m

  # Datasources
  additionalDataSources:
    - name: Loki
      type: loki
      access: proxy
      url: http://loki.observability.svc.cluster.local:3100
      isDefault: false
      editable: true

  service:
    type: ClusterIP
    port: 80

  # Anonymous access for development
  grafana.ini:
    auth.anonymous:
      enabled: false
    server:
      root_url: http://localhost:30030

# AlertManager
alertmanager:
  enabled: true

  alertmanagerSpec:
    storage:
      volumeClaimTemplate:
        spec:
          storageClassName: standard
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 1Gi

    resources:
      requests:
        memory: 128Mi
        cpu: 100m
      limits:
        memory: 256Mi
        cpu: 200m

  service:
    type: ClusterIP
    port: 9093

# Node Exporter
nodeExporter:
  enabled: true

# Kube State Metrics
kubeStateMetrics:
  enabled: true

# Default ServiceMonitor settings
defaultRules:
  create: true
  rules:
    alertmanager: true
    etcd: true
    configReloaders: true
    general: true
    k8s: true
    kubeApiserverAvailability: true
    kubeApiserverSlos: true
    kubelet: true
    kubeProxy: true
    kubePrometheusGeneral: true
    kubePrometheusNodeRecording: true
    kubernetesApps: true
    kubernetesResources: true
    kubernetesStorage: true
    kubernetesSystem: true
    kubeScheduler: true
    kubeStateMetrics: true
    network: true
    node: true
    nodeExporterAlerting: true
    nodeExporterRecording: true
    prometheus: true
    prometheusOperator: true
