# Railway configuration for MLflow service
# Deploy this service with: railway up --service mlflow-service

[build]
builder = "DOCKERFILE"
dockerfilePath = "docker/mlflow/Dockerfile"

[deploy]
startCommand = "/mlflow/docker-entrypoint.sh"
healthcheckPath = "/health"
healthcheckTimeout = 30
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[[deploy.environmentVariables]]
name = "MLFLOW_BACKEND_STORE_URI"
description = "PostgreSQL connection string for MLflow backend"
# Value should be set in Railway dashboard: ${{Postgres.DATABASE_URL}}

[[deploy.environmentVariables]]
name = "MLFLOW_DEFAULT_ARTIFACT_ROOT"
description = "S3 bucket path for MLflow artifacts"
# Example: s3://vision-platform-prod/mlflow-artifacts

[[deploy.environmentVariables]]
name = "AWS_ACCESS_KEY_ID"
description = "AWS/S3 access key ID"

[[deploy.environmentVariables]]
name = "AWS_SECRET_ACCESS_KEY"
description = "AWS/S3 secret access key"

[[deploy.environmentVariables]]
name = "AWS_S3_ENDPOINT_URL"
description = "Custom S3 endpoint URL (for Cloudflare R2, Backblaze B2, etc.)"
# Leave empty for AWS S3, set for alternative S3 services

[[deploy.environmentVariables]]
name = "MLFLOW_HOST"
value = "0.0.0.0"

[[deploy.environmentVariables]]
name = "MLFLOW_PORT"
value = "5000"

[[deploy.environmentVariables]]
name = "GUNICORN_WORKERS"
value = "2"

[[deploy.environmentVariables]]
name = "GUNICORN_THREADS"
value = "4"
