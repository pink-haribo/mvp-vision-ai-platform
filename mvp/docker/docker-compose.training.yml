version: '3.8'

# ============================================
# Vision Platform - Training Test Services
# For local testing of Docker training
# ============================================

services:
  # timm classification training test
  training-timm-test:
    image: vision-platform-timm:latest
    container_name: training-timm-test
    volumes:
      - ../data/sample_dataset:/workspace/dataset:ro
      - ../data/outputs:/workspace/output:rw
    environment:
      - PYTHONUNBUFFERED=1
      - JOB_ID=test-timm
    command: >
      python /opt/vision-platform/train.py
      --framework timm
      --task_type image_classification
      --model_name resnet18
      --dataset_path /workspace/dataset
      --dataset_format imagefolder
      --output_dir /workspace/output
      --epochs 1
      --batch_size 4
      --learning_rate 0.001
      --num_classes 10
      --job_id 9999

  # ultralytics YOLO training test
  training-ultralytics-test:
    image: vision-platform-ultralytics:latest
    container_name: training-ultralytics-test
    volumes:
      - ../data/yolo_dataset:/workspace/dataset:ro
      - ../data/outputs:/workspace/output:rw
    environment:
      - PYTHONUNBUFFERED=1
      - JOB_ID=test-ultralytics
    command: >
      python /opt/vision-platform/train.py
      --framework ultralytics
      --task_type object_detection
      --model_name yolov8n
      --dataset_path /workspace/dataset
      --dataset_format yolo
      --output_dir /workspace/output
      --epochs 1
      --batch_size 4
      --learning_rate 0.01
      --job_id 9998

  # YOLO-World test (zero-shot detection)
  training-yoloworld-test:
    image: vision-platform-ultralytics:latest
    container_name: training-yoloworld-test
    volumes:
      - ../data/yolo_dataset:/workspace/dataset:ro
      - ../data/outputs:/workspace/output:rw
    environment:
      - PYTHONUNBUFFERED=1
      - JOB_ID=test-yoloworld
    command: >
      python /opt/vision-platform/train.py
      --framework ultralytics
      --task_type zero_shot_detection
      --model_name yolov8s-worldv2
      --dataset_path /workspace/dataset
      --dataset_format yolo
      --output_dir /workspace/output
      --epochs 1
      --batch_size 4
      --learning_rate 0.01
      --job_id 9997
